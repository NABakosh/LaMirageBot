<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Dashboard - La Mirage Beauty</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			padding: 20px;
			min-height: 100vh;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
		}

		h1 {
			color: white;
			text-align: center;
			margin-bottom: 30px;
			font-size: 2.5rem;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.stat-card {
			background: white;
			padding: 25px;
			border-radius: 15px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			transition: transform 0.3s;
		}

		.stat-card:hover {
			transform: translateY(-5px);
		}

		.stat-card h3 {
			color: #667eea;
			font-size: 0.9rem;
			text-transform: uppercase;
			margin-bottom: 10px;
		}

		.stat-card .value {
			font-size: 2.5rem;
			font-weight: bold;
			color: #333;
		}

		.section {
			background: white;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			margin-bottom: 30px;
		}

		.section h2 {
			color: #667eea;
			margin-bottom: 20px;
			border-bottom: 3px solid #667eea;
			padding-bottom: 10px;
		}

		table {
			width: 100%;
			border-collapse: collapse;
		}

		th, td {
			padding: 12px;
			text-align: left;
			border-bottom: 1px solid #e0e0e0;
		}

		th {
			background: #f5f5f5;
			color: #667eea;
			font-weight: 600;
		}

		tr:hover {
			background: #f9f9f9;
		}

		.status {
			padding: 5px 15px;
			border-radius: 20px;
			font-size: 0.85rem;
			font-weight: 600;
		}

		.status.confirmed {
			background: #d4edda;
			color: #155724;
		}

		.status.pending {
			background: #fff3cd;
			color: #856404;
		}

		.status.rejected {
			background: #f8d7da;
			color: #721c24;
		}

		.loading {
			text-align: center;
			padding: 40px;
			color: #667eea;
			font-size: 1.2rem;
		}

		.master-card {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 15px;
		}

		.master-card h4 {
			font-size: 1.3rem;
			margin-bottom: 10px;
		}

		.master-stats {
			display: flex;
			justify-content: space-between;
			margin-top: 15px;
		}

		.master-stat {
			text-align: center;
		}

		.master-stat .label {
			font-size: 0.8rem;
			opacity: 0.9;
		}

		.master-stat .value {
			font-size: 1.5rem;
			font-weight: bold;
			margin-top: 5px;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>üìä Dashboard —Å–∞–ª–æ–Ω–∞ La Mirage Beauty</h1>

		<div class="stats-grid">
			<div class="stat-card">
				<h3>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</h3>
				<div class="value" id="totalBookings">-</div>
			</div>
			<div class="stat-card">
				<h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</h3>
				<div class="value" id="confirmedBookings">-</div>
			</div>
			<div class="stat-card">
				<h3>–ö–ª–∏–µ–Ω—Ç–æ–≤</h3>
				<div class="value" id="totalClients">-</div>
			</div>
			<div class="stat-card">
				<h3>–û–±—â–∏–π –¥–æ—Ö–æ–¥</h3>
				<div class="value" id="totalRevenue">-</div>
			</div>
		</div>

		<div class="section">
			<h2>üë®‚Äçüíº –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤</h2>
			<div id="mastersStats" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
		</div>

		<div class="section">
			<h2>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h2>
			<div id="bookingsTable" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
		</div>

		<div class="section">
			<h2>üë• –ö–ª–∏–µ–Ω—Ç—ã</h2>
			<div id="clientsTable" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
		</div>

		<div class="section">
			<h2>üìä –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏</h2>
			<div id="servicesStats" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
		</div>
	</div>

	<script>
		async function loadOverview() {
			try {
				const response = await fetch('/api/overview')
				const data = await response.json()

				document.getElementById('totalBookings').textContent = data.totalBookings
				document.getElementById('confirmedBookings').textContent = data.confirmedBookings
				document.getElementById('totalClients').textContent = data.totalClients
				document.getElementById('totalRevenue').textContent = data.totalRevenue.toLocaleString() + ' —Ç–≥'
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error)
			}
		}

		async function loadMasters() {
			try {
				const response = await fetch('/api/masters')
				const masters = await response.json()

				const html = masters.map(m => `
					<div class="master-card">
						<h4>${m.master_name}</h4>
						<div class="master-stats">
							<div class="master-stat">
								<div class="label">–ó–∞–ø–∏—Å–µ–π</div>
								<div class="value">${m.total_bookings}</div>
							</div>
							<div class="master-stat">
								<div class="label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</div>
								<div class="value">${m.confirmed_bookings}</div>
							</div>
							<div class="master-stat">
								<div class="label">–î–æ—Ö–æ–¥</div>
								<div class="value">${parseInt(m.revenue).toLocaleString()} —Ç–≥</div>
							</div>
						</div>
					</div>
				`).join('')

				document.getElementById('mastersStats').innerHTML = html
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–≤:', error)
				document.getElementById('mastersStats').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
			}
		}

		async function loadBookings() {
			try {
				const response = await fetch('/api/bookings')
				const bookings = await response.json()

				const html = `
					<table>
						<thead>
							<tr>
								<th>ID</th>
								<th>–î–∞—Ç–∞</th>
								<th>–í—Ä–µ–º—è</th>
								<th>–ö–ª–∏–µ–Ω—Ç</th>
								<th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
								<th>–£—Å–ª—É–≥–∞</th>
								<th>–ú–∞—Å—Ç–µ—Ä</th>
								<th>–¶–µ–Ω–∞</th>
								<th>–°—Ç–∞—Ç—É—Å</th>
							</tr>
						</thead>
						<tbody>
							${bookings.map(b => `
								<tr>
									<td>#${b.id}</td>
									<td>${b.date || '-'}</td>
									<td>${b.time ? b.time.substring(0, 5) : '-'}</td>
									<td>${b.client_name || '-'}</td>
									<td>${b.client_phone || '-'}</td>
									<td>${b.service || '-'}</td>
									<td>${b.master || '-'}</td>
									<td>${b.price ? b.price.toLocaleString() + ' —Ç–≥' : '-'}</td>
									<td><span class="status ${b.status}">${b.status}</span></td>
								</tr>
							`).join('')}
						</tbody>
					</table>
				`

				document.getElementById('bookingsTable').innerHTML = html
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π:', error)
				document.getElementById('bookingsTable').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
			}
		}

		async function loadClients() {
			try {
				const response = await fetch('/api/clients')
				const clients = await response.json()

				const html = `
					<table>
						<thead>
							<tr>
								<th>–ò–º—è</th>
								<th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
								<th>–ó–∞–ø–∏—Å–µ–π</th>
								<th>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</th>
								<th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç</th>
							</tr>
						</thead>
						<tbody>
							${clients.map(c => `
								<tr>
									<td>${c.name || '-'}</td>
									<td>${c.phone}</td>
									<td>${c.booking_count || 0}</td>
									<td>${parseInt(c.total_spent || 0).toLocaleString()} —Ç–≥</td>
									<td>${c.last_booking ? new Date(c.last_booking).toLocaleDateString() : '-'}</td>
								</tr>
							`).join('')}
						</tbody>
					</table>
				`

				document.getElementById('clientsTable').innerHTML = html
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', error)
				document.getElementById('clientsTable').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
			}
		}

		async function loadServicesStats() {
			try {
				const response = await fetch('/api/services-stats')
				const services = await response.json()

				const html = `
					<table>
						<thead>
							<tr>
								<th>–£—Å–ª—É–≥–∞</th>
								<th>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</th>
								<th>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</th>
								<th>–î–æ—Ö–æ–¥</th>
							</tr>
						</thead>
						<tbody>
							${services.map(s => `
								<tr>
									<td>${s.service}</td>
									<td>${s.count}</td>
									<td>${s.confirmed_count}</td>
									<td>${parseInt(s.total_revenue || 0).toLocaleString()} —Ç–≥</td>
								</tr>
							`).join('')}
						</tbody>
					</table>
				`

				document.getElementById('servicesStats').innerHTML = html
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É—Å–ª—É–≥:', error)
				document.getElementById('servicesStats').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'
			}
		}

		// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
		loadOverview()
		loadMasters()
		loadBookings()
		loadClients()
		loadServicesStats()

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
		setInterval(() => {
			loadOverview()
			loadMasters()
			loadBookings()
			loadClients()
			loadServicesStats()
		}, 30000)
	</script>
</body>
</html>